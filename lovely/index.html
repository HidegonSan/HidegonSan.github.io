<!DOCTYPE html>

<html lang="ja">
<html>
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="content-type" charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />

		<title>名前で相性診断 ♡ Lovely Test</title>
		<meta name="author" content="Hidegon" />
		<meta name="description" content="名前から簡単相性診断♡気になるあの人との相性は！？" />

		<!-- OGP -->
		<meta property="og:description" content="名前から簡単相性診断♡気になるあの人との相性は！？" />
		<meta property="og:title" content="名前で相性診断 ♡ Lovely Test" />
		<meta property="og:url" content="https://hidegonsan.github.io/lovely/" />
		<meta property="og:type" content="article" />
		<meta property="og:site_name" content="名前で相性診断 ♡ Lovely Test" />
		<meta property="og:locale" content="ja_JP" />

		<!-- Twitter card -->
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@Hidegon_" />
		
		<!-- font -->
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital@1&display=swap" rel="stylesheet">
		
		<!-- CSS -->
		<style type="text/css">
			body , html {
    			padding:0;
 			   margin:0;
			    height: 100%;
			}
			
			body {
				text-align: center;
				font-weight: bold;
				background-color: #FA82A7;
				overflow-x: hidden;
				color: white;
			}
			
			h1 {
				font-family: 'Open Sans', cursive;
				letter-spacing: 0.3em;
				font-size: 3em;
				color: #FA82A7;
				background-color: white;
				margin-left: calc(-50vw + 50%);
				margin-right: calc(-50vw + 50%);
				margin-top: calc(-50vw + 50%);
				border-bottom: 0.5em solid;
				border-image: linear-gradient(180deg, #FFFFFF, #FA82A7);
				border-image-slice: 100;
			}
			
			.footer {
				background-color: white;
				margin-left: calc(-50vw + 50%);
				margin-right: calc(-50vw + 50%);
				border-top: 0.5em solid;
				border-image: linear-gradient(180deg, #FA82A7, #FFFFFF);
				border-image-slice: 100;
				position: absolute;
				bottom: 0;
				width: 100%;
				height: 3em;
			}

			small {
				color: #FA82A7;
				font-size: 0.8em;
				font-weight: bold;
			}

			.dot {
				height: 100%;
				width: 100%;
				background-color: #fa82a7;
				background-image: radial-gradient(#FFB0C4 21%, transparent 21%), radial-gradient(#FFB0C4 21%, transparent 21%);
				background-position: 0 0, 40px 40px;
				background-size: 80px 80px;
			}
		</style>
	</head>


	<body>

		<div class="dot">
			<h1>Lovely Test</h1>
			<div class="how2">
				<h2>How to use?</h2>
				<p>下の入力BOXにローマ字 (ヘボン式) で入力してね</p>
			</div>
			<div class="heart">
				<input type="text" id="name1" name="name1">
				<label for="name1">あなたの名前を入力</label>
				<input type="text" id="name2" name="name2">
				<label for="name2">相手の名前を入力</label>
			</div>
			
			<button id="calc">計算</button>
			<p id="result">???</p>
		</div>
		
		<footer class="footer">
			<small>&copy; 2021 Hidegon.</small>
		</footer>
	</body>


	<script language="javascript" type="text/javascript">
	
	
		const _sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
		
		
		function chemistry_test(name1, name2) {
			// 計算不可
			if ((!name1.length && name2.length < 2) || (!name2.length && name1.length < 2)) {
				return 0;
			}

			var extended_name = name1.toUpperCase() + name2.toUpperCase();
			var nums = [];
			var tmp = [];
			var checked_string = [];
	
			for (var p=0; p<extended_name.length; p++) {
				var s = extended_name.slice(p, p+1);
				if (checked_string.indexOf(s) === -1) {
					var count = (extended_name.match(new RegExp(s, "g")) || []).length;
					nums.push(count);
					checked_string.push(s);
				}
			}
	
			while (true) {
				if (nums.length == 2) {
					return Number(nums.shift().toString() + nums.pop().toString());
				}
		
				// FIXME: 何故か +10 しないと動かない
				// このバグの原因を見つけた方はご連絡ください
				for (var i=0; i<Math.ceil(nums.length / 2) + 10;   i++) {
					if (nums.length) {
						if (nums.length > 1) {
							tmp.push(nums.shift() + nums.pop())
						}
						else {
							tmp.push(nums.shift());
						}
					}
				}
				nums = tmp.slice();
				tmp.splice(0);
			}
		}
		
		
		function rand_range(min, max) {
			return Math.floor(Math.random()*(max + 1 - min)) + min;
		}
		
		
		async function calc() {
			var name1 = document.getElementById("name1").value;
			var name2 = document.getElementById("name2").value;
			var percentage = chemistry_test(name1, name2);
			var mi = Number("1" + "0".repeat(percentage.toString().length - 1));
			var ma = Number("9" + "9".repeat(percentage.toString().length - 1))
			await _sleep(500)
			for (var v=0; v<10; v++) {
				document.getElementById("result").innerHTML =  rand_range(mi, ma).toString();
				await _sleep(50*v);
			}
			document.getElementById("result").innerHTML = percentage.toString();
		}


		var calc_button = document.getElementById("calc");
		calc_button.addEventListener("click", function() {
			calc();
		});
		
		// (C) 2021 Hidegon
		// This source code is part of https://hidegonsan.github.io/lovely/
	</script>

</html>
